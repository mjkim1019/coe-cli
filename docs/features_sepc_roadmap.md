# Swing CLI 기능 명세서 (Architect 모드 추가 개편안)

## 목차
- [0. 핵심 개념](#0-핵심-개념)  
- [1. 사용자 흐름 (Text-to-SQL 예시)](#1-사용자-흐름-text-to-sql-예시)  
- [2. P0 완료 기능](#2-p0-완료-기능)  
- [3. 기능 우선순위](#3-기능-우선순위)  
  - [P1 (2025 Q4 목표)](#-p1-2025-q4-목표)  
  - [P2 (2026 Q1 목표)](#-p2-2026-q1-목표)  
  - [P3 (2026 Q2 목표)](#-p3-2026-q2-목표-부가-기능)  
- [4. 파일 타입별 특화 분석](#4-파일-타입별-특화-분석)  
- [5. 특수 용어 인식](#5-특수-용어-인식)  
- [6. 주요 명령어](#6-주요-명령어)  
  - [6.1 현재 구현된 명령어](#61-현재-구현된-명령어)  
  - [6.2 개발 예정 명령어](#62-개발-예정-명령어)  

---

## 0. 핵심 개념

- **Architect 모드**  
  `/architect "기능 요청"` 하나만으로 Plan 생성 → 편집 실행 → 테스트 → 적용까지 자동 오케스트레이션 수행.  
  사용자는 목표만 자연어로 입력하고, LLM이 `/edit`, `/exec`, `/repair` 등 필요한 명령을 추천.

- **대화형 REPL**  
  `/ask`, `/edit`, `/architect` 등 명령 기반 인터페이스 + 자동완성.  
  파일 타입별 분석(C/XML/SQL) 지원 및 코드 구조 요약 제공.

- **자동 세션 저장**  
  실행마다 `plan.yaml`, diff, 테스트 로그가 세션 단위 저장.  
  `/resume` 명령으로 언제든 복원 가능.

- **AGENTS.md 자동 생성**  
  `coe init` 시 프로젝트 컨텍스트 템플릿 자동 생성.  
  (도메인, 스택, 도구, 제약사항 기록 → 에이전트 이해도 향상)

---

## 1. 사용자 흐름 (Text-to-SQL 예시)

```bash
coe init
  # .coe/ 디렉터리 생성 및 AGENTS.md 템플릿 자동 생성

/architect "유선 회선 기준으로 유무선 결합 가입년수 합산값 조회하는 쿼리 개발해줘"
  # 자연어 요청 → Plan 작성 → 단계별 편집/실행 제안
  # (LLM) ➜ "아래 명령을 제안합니다: /edit, /exec"
  # 사용자는 제안된 명령을 accept 여부만 결정
  # (자동) ➜ plan.yaml 생성, 신규 SQL 파일 생성
  # (자동) ➜ 세션 저장되어 resume 가능

/resume
  # 이전 세션 이어서 진행

/ask "<테이블명> 테이블은 왜 필요한거야?"
  # 자유 질의
```

---

## 2. P0 완료 기능

| 기능 | 설명 |
|------|------|
| **LLM 기반 코드 구조 분석** | 계층 구조, 호출 관계, 파일 카테고리화 및 자연어 요약 제공. C/XML/SQL 전용 분석 프롬프트 지원 |
| **대화형 CLI (REPL)** | `prompt_toolkit` 기반 CLI, `/add`, `/ask`, `/edit`, `/test` 등 명령어 지원 |
| **파일 타입별 특화 분석** | C/XML/SQL 전용 심화 분석 프롬프트 |
| **템플릿 기반 신규 파일 생성** | 미리 정의된 템플릿으로 파일 자동 생성 |
| **온디맨드 분석 & 캐싱** | `/add` 시 기본 분석 → 요청 시 심화 분석 & 결과 캐싱 |
| **JSON 응답 처리 & 디버그 로그** | LLM 응답을 JSON으로 강제, 호출 과정을 로깅 |

---

## 3. 기능 우선순위

### 📌 P1 (2025 Q4 목표)
- 튜토리얼 모드 (대화형 가이드)
- Text-to-SQL 기능
- Plan & Execute 기능
- AGENTS.md Rule 파일 자동 생성

### 📌 P2 (2026 Q1 목표)
- 프롬프트 캐싱
- Model Context Protocol (MCP) 지원
- 파일 감시 (Hot Reload)
- Edit GuardRail
- 세션 이어서 하기 (강화된 컨텍스트 복원)

### 📌 P3 (2026 Q2 목표, 부가 기능)
- 자동 테스트 (Makefile/CMake 기반)
- 정교한 diff/patch (롤백, 백업 포함)
- 세션 관리 고도화 (자동 컨텍스트 구성)

---

## 4. 파일 타입별 특화 분석

| 파일 타입 | 핵심 분석 대상 | 특징 |
|-----------|---------------|------|
| **C 파일 (.c)** | IO Formatter, `c000_main_proc`, DBIO 호출 패턴 | 표준 함수 구조 자동 인식 (`a000_init_proc`, `b000_input_validation`, `c000_main_proc`, `z999_err_exit_proc`) |
| **XML 파일 (.xml)** | TrxCode 호출 패턴, UI 컴포넌트, JS 함수 (`scwin.xxx`), 데이터 흐름 | TrxCode 중심 분석 |
| **SQL 파일 (.sql)** | 바인드 변수, SELECT 결과 nullable, 테이블 조인, Oracle 힌트 | Oracle 전용 `(+)`, NVL, TO_CHAR, 특수 날짜 패턴(`99991231`) |
| **기타 파일** | 주석 기반 목적 추출, 함수/의존성/입출력 파라미터 분석 | 일반 분석 수행 |

---

## 5. 특수 용어 인식

- **DBIO (Database Input/Output)** → 자동으로 DB 컨텍스트 활성화  
  - SQL 작성 & 최적화  
  - DB 연결 & 트랜잭션 처리  
  - 데이터 입출력 로직 분석  
  - 성능 튜닝  

---

## 6. 주요 명령어

### 6.1 현재 구현된 명령어

| 명령어 | 설명 |
|--------|------|
| `/add <파일>` | 파일을 분석 컨텍스트에 추가 |
| `/ask` | 코드 구조/로직 질의 |
| `/edit` | 수정 모드 진입 (전체/블록/udiff) |
| `/test` | 테스트 실행 |
| `/preview` | 변경사항 미리보기 |
| `/apply` | 변경사항 실제 적용 |
| `/help` | 명령어 목록 및 도움말 |
| `/exit` | 세션 종료 |
| `/repo` | 작업 디렉터리 파일 구조 분석 |

### 6.2 개발 예정 명령어

| 명령어 | 설명 |
|--------|------|
| `/architect` | Plan & Execute 모드 시작 |
| `/tutorial` | 튜토리얼 모드 시작 |
| `/watch <dir>` | 파일 변경 감시 및 자동 분석·테스트 |
| `coe test` | 명령줄에서 테스트 실행 |
| `coe diff` | 변경된 파일 diff 확인 |
| `coe patch` | 패치 적용 |
| `coe revert` | 변경 롤백 |
| `coe save-session` | 세션 저장 |
| `coe resume` | 세션 복원 |
| `/continue` | 이전 세션 이어서 시작 |
