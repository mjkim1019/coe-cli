# 🧠 coe analyze 사용 가이드

## 개요

`coe analyze` 명령어는 LLM을 활용한 강력한 코드 구조 분석 도구입니다. 파일의 목적, 복잡도, 호출 관계, 개선사항 등을 자동으로 분석하여 제공합니다.

## 기본 사용법

```bash
# 단일 파일 분석
python coe.py analyze main.c

# 여러 파일 분석
python coe.py analyze file1.c file2.sql

# 디렉토리 전체 분석
python coe.py analyze src/

# 패턴 매칭으로 분석
python coe.py analyze *.c *.h
```

## 옵션

```bash
# LLM 분석 없이 기본 분석만
python coe.py analyze src/ --no-llm

# 결과를 JSON 파일로 저장
python coe.py analyze src/ -o analysis_result.json

# 버전 확인
python coe.py version
```

## 분석 결과

### 1. 전체 요약
- 분석된 파일 수
- 파일 타입별 분포
- 복잡도 분석 (평균, 최고, 최저)

### 2. 파일 카테고리
- **CONTROLLER**: 메인 로직, 컨트롤러 파일들
- **UTILS**: 유틸리티, 헬퍼 함수들
- **SERVICE**: 서비스 로직 파일들
- **SQL**: 데이터베이스 쿼리 파일들
- **CONFIG**: 설정 파일들
- **UI**: 사용자 인터페이스 파일들

### 3. 파일별 상세 분석
각 파일마다 다음 정보를 제공:
- **목적**: 파일의 주요 역할과 기능
- **복잡도**: 1-10 점수로 복잡도 평가
- **주요 함수**: 핵심 함수들과 역할
- **개선사항**: LLM이 제안하는 개선 방안

### 4. 호출 관계 그래프
- 파일 간 의존성 관계
- 함수 호출 패턴 분석

## REPL 내 자동 분석

### /add 명령 시 자동 분석
```
> /add main.c
# 기본 분석 + LLM 심화 분석 자동 수행
```

### /edit 명령 후 자동 분석
```
> /edit
> 로깅 기능 추가해줘
# 수정 미리보기 + 수정 후 파일 분석 자동 수행
```

## 지원 파일 타입

- **.c**: C 소스 파일 (표준 함수 구조 인식)
- **.h**: C 헤더 파일 (구조체, #define 분석)
- **.sql**: SQL 파일 (Oracle 특화 분석)
- **.xml**: XML 파일 (UI 구조 분석)
- **.py**: Python 파일 (일반 분석)

## 예시 출력

```
🎯 코드 구조 분석 결과

📊 전체 요약
┌─────────────────────────────────────────────────────────────────────────┐
│ 분석된 파일 수: 5개                                                     │
│                                                                         │
│ 파일 타입별 분포:                                                       │
│   • c_file: 3개                                                         │
│   • sql_file: 2개                                                       │
│                                                                         │
│ 복잡도 분석:                                                            │
│   • 평균: 6.2/10                                                        │
│   • 최고: 8/10                                                          │
│   • 최저: 4/10                                                          │
└─────────────────────────────────────────────────────────────────────────┘

📁 파일 카테고리
└── CONTROLLER (2개)
    ├── 📄 main.c
    └── 📄 service.c
└── SQL (2개)
    ├── 📄 user_query.sql
    └── 📄 data_select.sql
└── OTHER (1개)
    └── 📄 utils.c

📋 파일별 상세 분석

📄 main.c
┌─────────────────────────────────────────────────────────────────────────┐
│ 목적: 사용자 요청을 처리하고 데이터베이스 연동을 통해 결과를 반환하는   │
│ 메인 컨트롤러 역할                                                      │
│                                                                         │
│ 복잡도: 7/10                                                            │
│                                                                         │
│ 주요 함수: a000_init_proc, c000_main_proc, z000_norm_exit_proc         │
│                                                                         │
│ 개선사항: 에러 처리 로직을 더 세분화하고 로깅 기능을 추가하면 유지보수  │
│ 성이 향상될 것입니다                                                    │
└─────────────────────────────────────────────────────────────────────────┘
```

## 성능 최적화

- 대용량 디렉토리는 주요 파일 우선 분석 (최대 50개)
- LLM 호출 최적화로 빠른 응답
- 파일 타입별 특화 분석으로 정확도 향상

## 주의사항

- LLM 분석은 인터넷 연결이 필요합니다
- `--no-llm` 옵션으로 오프라인 기본 분석 가능
- 대용량 파일의 경우 일부 내용만 분석될 수 있습니다