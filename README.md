# 🌀 Swing CLI

`Swing CLI`는 LLM 백엔드와 통신하여, 사용자가 코드에 대해 **질문하고**, **수정하고**, **테스트하며**, **코드 구조를 분석**할 수 있는 대화형 CLI 도구입니다.

## 🧑‍💻 Target Users
- 개발자 (Python, C, SQL 등 사용하는 팀)
- 프로그램 운영자 (시스템 분석, 유지보수, 배포 전 검토 등)

## 🎯 핵심 기능

### 🧠 코드 구조 분석
- **계층 구조**: 디렉토리-파일-함수 구조 트리 분석
- **호출 관계**: 함수 간 call graph 생성
- **파일 카테고리화**: controller, utils, service, sql, config 등 자동 분류
- **자연어 요약**: 파일별 주요 기능 요약

### 💬 대화형 CLI REPL
- 명령어 기반 대화형 인터페이스
- 명령어 자동완성 지원
- `/add <파일>`로 작업 컨텍스트에 파일 추가
- `/ask`, `/edit` 명령으로 모드 전환
- 한국어 질문 지원

### 🧩 파일 자동 인식
- **C 파일 (.c)**: 표준 함수 패턴 자동 인식 (`a000_init_proc`, `z999_err_exit_proc` 등)
- **SQL 파일 (.sql)**: Oracle SQL 특화 분석 (힌트, 바인드 변수, 아우터 조인 등)

### 🧪 자동 테스트 기능
- 파일 저장/수정 시 자동 테스트 실행
- Makefile, CMake 또는 내장 스크립트 지원
- 에러, 로그, diff 포함한 상세 결과 출력

### 🧵 세션 및 컨텍스트 관리
- 세션 저장/복구 기능
- LLM 기반 자동 컨텍스트 구성
- 파일별 상태 추적

### 🧬 정교한 diff 및 충돌 복구
- 변경사항 diff 분석
- 패치 적용 및 롤백 기능
- 자동 백업 생성 (`.bak`, `.diff`)

## 아키텍처

`coe-cli`는 사용자의 입력을 받아 백엔드 서버로 전달하는 **클라이언트**와, 실제 LLM 호출을 처리하는 **백엔드**로 구성된 클라이언트-서버 아키텍처를 따릅니다. 원활한 사용을 위해 백엔드 서버가 먼저 실행되어야 합니다.

## 사전 준비 사항

- Python 3.8 이상
- Docker 및 Docker Compose

## 설치 및 실행 방법

### 1. 백엔드 서버 실행

`coe-cli`는 Docker Compose를 사용하여 백엔드 환경을 실행합니다. 프로젝트 루트 디렉토리에서 다음 명령어를 실행하세요.

```bash
docker-compose up -d
```

### 2. 클라이언트(coe-cli) 설정

백엔드 서버가 실행된 후, 별도의 터미널에서 다음 단계를 따라 클라이언트를 설정합니다.

#### 가상 환경 생성 및 활성화

```bash
# 가상 환경 생성 (최초 한 번)
python3 -m venv .venv

# 가상 환경 활성화 (새 터미널을 열 때마다)
source .venv/bin/activate
```

#### 필요 라이브러리 설치

```bash
# 가상 환경이 활성화된 상태에서 실행
pip3 install -r requirements.txt
```

### 3. Swing CLI 실행

모든 설정이 완료되면 다음 명령어로 `Swing CLI`를 시작합니다.

```bash
python3 cli/main.py
```

## 사용법

`Swing CLI`가 실행되면 프롬프트(`>`)가 나타납니다.

1.  **파일 추가**: `/add` 명령어로 분석하거나 수정할 파일을 컨텍스트에 추가합니다.
    ```
    > /add path/to/your_file.py
    ```

2.  **모드 선택**: `/ask` 또는 `/edit`으로 작업 모드를 설정합니다.
    ```
    > /ask                    # 질문 모드
    > /edit                   # 기본 편집 모드 (whole)
    > /edit udiff             # 정밀 수정 (한두줄 오타 등)
    > /edit block             # 함수/블록 교체
    ```

3.  **질문 또는 요청**: 원하는 내용을 입력합니다.
    ```
    > 이 파일의 주요 기능은 무엇인가요?        # ask 모드
    > print 오타 수정해줘                     # edit udiff 모드  
    > User 클래스 추가해줘                    # edit whole 모드
    ```

## 📊 CLI 명령어 요약

| 명령어 | 설명 |
|--------|------|
| `/add <파일>` | 파일 컨텍스트에 추가 |
| `/ask` | 질문 모드 |
| `/edit` | 수정 모드 |
| `/test` | 테스트 실행 |
| `/preview` | 마지막 edit 응답의 변경사항 미리보기 |
| `/apply` | 변경사항을 실제 파일에 적용 |
| `/help` | 도움말 표시 |
| `/exit` | CLI 종료 |

### 고급 명령어 (개발 예정)
| 명령어 | 설명 |
|--------|------|
| `coe analyze` | 구조 분석 |
| `coe diff` | 변경점 확인 |
| `coe patch` | 수정 적용 |
| `coe revert` | 수정 롤백 |
| `coe save-session` | 세션 저장 |
| `coe resume` | 세션 복구 |
| `coe web` | Web UI 실행 |

## 편집 전략별 특징

| 전략 | 적합한 상황 | 예시 |
| --- | --- | --- |
| **whole** | 새 파일 생성, 대규모 변경 | 새 클래스 추가, 파일 구조 변경 |
| **block** | 특정 함수/블록 수정 | 함수 로직 변경, 메서드 추가 |  
| **udiff** | 정밀한 라인 수정 | 오타 수정, 한두줄 변경 |

## 📅 로드맵

| 버전 | 기능 | 상태 |
|------|------|------|
| v0.1 | 기본 CLI + 파일 관리 | ✅ 완료 |
| v0.2 | 구조 분석 + 테스트 | ⏳ 진행 중 |
| v0.3 | Web 시각화 + MCP + ReAct | 🛠 예정 |
| v0.4 | 세션 관리, diff 복구 등 | 📌 예정 |
